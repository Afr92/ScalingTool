<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scaling Tool</title>
  <meta name="description" content="Real-life scaled dimensions from X-rays. Runs 100% locally in your browser." />
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; --danger:#ef4444; --focus:#60a5fa;
    }
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 800px at 10% -10%, #1f2937 0, #0b1023 60%), var(--bg); color:var(--text);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card{
      width:min(680px, 100%); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }
    h1{margin:0 0 8px; font-size:1.9rem; letter-spacing:.2px} /* Larger title font */
    p.sub{margin:0 0 6px; color:var(--muted); font-size:.95rem; font-style:italic}
    p.byline{margin:0 0 20px; color:var(--muted); font-size:.95rem; font-style:italic}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width:640px){ .grid{grid-template-columns:1fr} }
    label{font-size:.9rem; color:var(--muted); display:block; margin:0 0 6px}
    input, select{
      width:100%; padding:12px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
      background:#0b1023; color:var(--text); outline:none; transition:.15s border-color, .15s box-shadow;
    }
    input:focus, select:focus{ border-color: var(--focus); box-shadow: 0 0 0 3px rgba(96,165,250,.25)}
    .row{margin:8px 0}
    .actions{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    button{
      cursor:pointer; border:1px solid rgba(255,255,255,.14); background:#101426; color:var(--text);
      padding:10px 14px; border-radius:10px; font-weight:600; transition:.15s transform,.15s background;
    }
    /* Bigger CALCULATE button and all caps */
    button.primary{
      background:linear-gradient(135deg, #16a34a, #22c55e); border:none; color:#052e16;
      padding:12px 18px; font-size:1rem; letter-spacing:.3px;
    }
    button:hover{ transform: translateY(-1px) }
    .out{
      margin-top:18px; padding:14px; border-radius:12px; background:#0a122a; border:1px solid rgba(255,255,255,.08)
    }
    .out h2{ margin:0 0 6px; font-size:1.05rem }
    .muted{ color:var(--muted) }
    .warn{ color:var(--danger); font-weight:600 }
    .footer{ margin-top:14px; color:var(--muted); font-size:.85rem }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Scaling Tool</h1>
    <p class="sub"><em>Real-life scaled dimensions from X-rays. Runs 100% locally in your browser.</em></p>
    <p class="byline"><em>By Amed for Dr. Giotikas</em></p>

    <form id="calc-form" novalidate>
      <div class="grid" aria-describedby="helper">
        <!-- Field 1 -->
        <div class="row">
          <label for="in1">Original nail diameter (in millimeters)</label>
          <input id="in1" name="in1" type="number" inputmode="decimal" step="any" required placeholder="e.g., 10" />
        </div>

        <!-- Field 2 -->
        <div class="row">
          <label for="in2">X-rays nail diameter (in millimeters)</label>
          <input id="in2" name="in2" type="number" inputmode="decimal" step="any" required placeholder="e.g., 25" />
        </div>

        <!-- Field 3 -->
        <div class="row">
          <label for="in3">X-rays distraction to be scaled (in millimeters)</label>
          <input id="in3" name="in3" type="number" inputmode="decimal" step="any" required placeholder="e.g., 8" />
        </div>

        <!-- Field 4 -->
        <div class="row">
          <label for="in4">Scaling factor for final result (in millimeters)</label>
          <input id="in4" name="in4" type="number" inputmode="decimal" step="any" placeholder="Optional, e.g., 0" />
        </div>
      </div>

      <div class="actions">
        <button type="button" class="primary" id="btn-calc">CALCULATE</button>
        <button type="reset" id="btn-reset" title="Clear all inputs">Clear</button>
        <button type="button" id="btn-copy" title="Copy result">Copy Result</button>
        <button type="button" id="btn-link" title="Share pre-filled link">Share Link</button>
      </div>

      <div class="out" role="status" aria-live="polite">
        <h2>Result</h2>
        <div id="result" style="font-size:1.2rem; font-weight:700">—</div>
        <div id="interpretation" class="muted">Enter values and click CALCULATE.</div>
      </div>

      <p id="helper" class="footer">
        <strong>Disclaimer:</strong> This tool is for informational purposes and does not replace clinical judgment.
      </p>
    </form>
  </main>

  <script>
    // Utility: read/write query params to allow sharable pre-filled links
    const qs = new URLSearchParams(location.search);
    const fields = ["in1","in2","in3","in4"];

    function getNums() {
      const out = {};
      for (const k of fields) {
        const el = document.getElementById(k);
        const v = el.value.trim();
        out[k] = v === "" ? null : Number(v);
      }
      return out;
    }

    function setFromQuery() {
      for (const k of fields) {
        const val = qs.get(k);
        if (val !== null) document.getElementById(k).value = val;
      }
    }

    function updateQueryFromInputs() {
      const params = new URLSearchParams();
      for (const k of fields) {
        const v = document.getElementById(k).value.trim();
        if (v !== "") params.set(k, v);
      }
      history.replaceState(null, "", location.pathname + (params.toString() ? "?" + params.toString() : ""));
    }

    // Basic sanity checks (adjust if you prefer stricter ranges)
    function validateRanges(values) {
      const problems = [];
      // All inputs are lengths (mm) and should be >= 0; in2 should not be 0 (division)
      if (values.in1 !== null && values.in1 < 0) problems.push("Original nail diameter cannot be negative.");
      if (values.in2 !== null && values.in2 <= 0) problems.push("X-rays nail diameter must be greater than 0.");
      if (values.in3 !== null && values.in3 < 0) problems.push("X-rays distraction cannot be negative.");
      if (values.in4 !== null && values.in4 < 0) problems.push("Scaling factor cannot be negative (use 0 if none).");
      return problems;
    }

    // Calculation: Result = (Field1 / Field2) * Field3 - Field4
    function calculate(values) {
      const { in1, in2, in3, in4 } = values;
      if (in1 === null || in2 === null || in3 === null) {
        return { ok:false, message:"Please fill the first three fields." };
      }
      if (in2 === 0) {
        return { ok:false, message:"X-rays nail diameter cannot be 0." };
      }
      const scalar = in1 / in2;
      const result = scalar * in3 - (in4 ?? 0);
      return { ok:true, value: result, note: "" };
    }

    function formatNumber(x, decimals = 2) {
      return new Intl.NumberFormat(undefined, { maximumFractionDigits: decimals, minimumFractionDigits: decimals }).format(x);
    }

    function onCalculate() {
      const values = getNums();
      const problems = validateRanges(values);
      const resultEl = document.getElementById("result");
      const interpEl = document.getElementById("interpretation");

      if (problems.length) {
        resultEl.textContent = "Check inputs";
        interpEl.innerHTML = `<span class="warn">${problems.join(" ")}</span>`;
        return;
      }

      const res = calculate(values);
      if (!res.ok) {
        resultEl.textContent = "—";
        interpEl.textContent = res.message || "Unable to compute.";
        return;
      }

      const decimals = 2; // keep 2 decimals (note removed from UI as requested)
      resultEl.textContent = `${formatNumber(res.value, decimals)} mm`;
      interpEl.textContent = res.note || "";
    }

    function onCopy() {
      const txt = `Result: ${document.getElementById("result").textContent}\n` +
                  `Inputs: ` + fields.map(k => `${k}=${document.getElementById(k).value}`).join(", ");
      navigator.clipboard?.writeText(txt);
    }

    function onShareLink() {
      updateQueryFromInputs();
      const url = location.href;
      navigator.clipboard?.writeText(url);
      const interpEl = document.getElementById("interpretation");
      interpEl.textContent = "Sharable link copied to clipboard.";
    }

    document.getElementById("btn-calc").addEventListener("click", onCalculate);
    document.getElementById("btn-copy").addEventListener("click", onCopy);
    document.getElementById("btn-link").addEventListener("click", onShareLink);
    document.getElementById("btn-reset").addEventListener("click", () => {
      history.replaceState(null, "", location.pathname);
      document.getElementById("result").textContent = "—";
      document.getElementById("interpretation").textContent = "Enter values and click CALCULATE.";
    });

    // Prefill from URL if present
    setFromQuery();
  </script>
</body>
</html>
